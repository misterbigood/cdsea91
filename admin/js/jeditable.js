(function(b){b.fn.editable=function(c,e){if("disable"==c)b(this).data("disabled.editable",!0);else if("enable"==c)b(this).data("disabled.editable",!1);else if("destroy"==c)b(this).unbind(b(this).data("event.editable")).removeData("disabled.editable").removeData("event.editable");else{var a=b.extend({},b.fn.editable.defaults,{target:c},e),g=b.editable.types[a.type].plugin||function(){},k=b.editable.types[a.type].submit||function(){},s=b.editable.types[a.type].buttons||b.editable.types.defaults.buttons, q=b.editable.types[a.type].content||b.editable.types.defaults.content,t=b.editable.types[a.type].element||b.editable.types.defaults.element,p=b.editable.types[a.type].reset||b.editable.types.defaults.reset,r=a.callback||function(){},u=a.onedit||function(){},v=a.onsubmit||function(){},w=a.onreset||function(){},x=a.onerror||p;a.tooltip&&b(this).attr("title",a.tooltip);a.autowidth="auto"==a.width;a.autoheight="auto"==a.height;return this.each(function(){var d=this,c=b(d).width(),e=b(d).height();b(this).data("event.editable", a.event);b.trim(b(this).html())||b(this).html(a.placeholder);b(this).bind(a.event,function(l){if(!0!==b(this).data("disabled.editable")&&!d.editing&&!1!==u.apply(this,[a,d])){l.preventDefault();l.stopPropagation();a.tooltip&&b(d).removeAttr("title");0==b(d).width()?(a.width=c,a.height=e):("none"!=a.width&&(a.width=a.autowidth?b(d).width():a.width),"none"!=a.height&&(a.height=a.autoheight?b(d).height():a.height));b(this).html().toLowerCase().replace(/(;|")/g,"")==a.placeholder.toLowerCase().replace(/(;|")/g, "")&&b(this).html("");d.editing=!0;d.revert=b(d).html();b(d).html("");var f=b("<form />");a.cssclass&&("inherit"==a.cssclass?f.attr("class",b(d).attr("class")):f.attr("class",a.cssclass));a.style&&("inherit"==a.style?(f.attr("style",b(d).attr("style")),f.css("display",b(d).css("display"))):f.attr("style",a.style));var h=t.apply(f,[a,d]),m;if(a.loadurl){var n=setTimeout(function(){h.disabled=!0;q.apply(f,[a.loadtext,a,d])},100);l={};l[a.id]=d.id;b.isFunction(a.loaddata)?b.extend(l,a.loaddata.apply(d, [d.revert,a])):b.extend(l,a.loaddata);b.ajax({type:a.loadtype,url:a.loadurl,data:l,async:!1,success:function(a){window.clearTimeout(n);m=a;h.disabled=!1}})}else a.data?(m=a.data,b.isFunction(a.data)&&(m=a.data.apply(d,[d.revert,a]))):m=d.revert;q.apply(f,[m,a,d]);h.attr("name",a.name);s.apply(f,[a,d]);b(d).append(f);g.apply(f,[a,d]);b(":input:visible:enabled:first",f).focus();a.select&&h.select();h.keydown(function(b){27==b.keyCode&&(b.preventDefault(),p.apply(f,[a,d]))});"cancel"==a.onblur?h.blur(function(b){n= setTimeout(function(){p.apply(f,[a,d])},500)}):"submit"==a.onblur?h.blur(function(a){n=setTimeout(function(){f.submit()},200)}):b.isFunction(a.onblur)?h.blur(function(b){a.onblur.apply(d,[h.val(),a])}):h.blur(function(a){});f.submit(function(c){n&&clearTimeout(n);c.preventDefault();if(!1!==v.apply(f,[a,d])&&!1!==k.apply(f,[a,d]))if(b.isFunction(a.target))c=a.target.apply(d,[h.val(),a]),b(d).html(c),d.editing=!1,r.apply(d,[d.innerHTML,a]),b.trim(b(d).html())||b(d).html(a.placeholder);else{c={};c[a.name]= h.val();c[a.id]=d.id;b.isFunction(a.submitdata)?b.extend(c,a.submitdata.apply(d,[d.revert,a])):b.extend(c,a.submitdata);"PUT"==a.method&&(c._method="put");b(d).html(a.indicator);var e={type:"POST",data:c,dataType:"html",url:a.target,success:function(c,f){"html"==e.dataType&&b(d).html(c);d.editing=!1;r.apply(d,[c,a]);b.trim(b(d).html())||b(d).html(a.placeholder)},error:function(b,c,e){x.apply(f,[a,d,b])}};b.extend(e,a.ajaxoptions);b.ajax(e)}b(d).attr("title",a.tooltip);return!1})}});this.reset=function(c){this.editing&& !1!==w.apply(c,[a,d])&&(b(d).html(d.revert),d.editing=!1,b.trim(b(d).html())||b(d).html(a.placeholder),a.tooltip&&b(d).attr("title",a.tooltip))}})}};b.editable={types:{defaults:{element:function(c,e){var a=b('<input type="hidden"></input>');b(this).append(a);return a},content:function(c,e,a){b(":input:first",this).val(c)},reset:function(b,e){e.reset(this)},buttons:function(c,e){var a=this;if(c.submit){if(c.submit.match(/>$/))var g=b(c.submit).click(function(){"submit"!=g.attr("type")&&a.submit()}); else g=b('<button type="submit" />'),g.html(c.submit);b(this).append(g)}if(c.cancel){if(c.cancel.match(/>$/))var k=b(c.cancel);else k=b('<button type="cancel" />'),k.html(c.cancel);b(this).append(k);b(k).click(function(g){(b.isFunction(b.editable.types[c.type].reset)?b.editable.types[c.type].reset:b.editable.types.defaults.reset).apply(a,[c,e]);return!1})}}},text:{element:function(c,e){var a=b("<input />");"none"!=c.width&&a.width(c.width);"none"!=c.height&&a.height(c.height);a.attr("autocomplete", "off");b(this).append(a);return a}},textarea:{element:function(c,e){var a=b("<textarea />");c.rows?a.attr("rows",c.rows):"none"!=c.height&&a.height(c.height);c.cols?a.attr("cols",c.cols):"none"!=c.width&&a.width(c.width);b(this).append(a);return a}},select:{element:function(c,e){var a=b("<select />");b(this).append(a);return a},content:function(c,e,a){if(String==c.constructor)eval("var json = "+c);else var g=c;for(var k in g)g.hasOwnProperty(k)&&"selected"!=k&&(c=b("<option />").val(k).append(g[k]), b("select",this).append(c));b("select",this).children().each(function(){b(this).val()!=g.selected&&b(this).text()!=b.trim(a.revert)||b(this).attr("selected","selected")})}}},addInputType:function(c,e){b.editable.types[c]=e}};b.fn.editable.defaults={name:"value",id:"id",type:"text",width:"auto",height:"auto",event:"click.editable",onblur:"cancel",loadtype:"GET",loadtext:"Loading...",placeholder:"\u00e9diter",loaddata:{},submitdata:{},ajaxoptions:{}}})(jQuery); jQuery.expr[":"].focus=function(b){return b===document.activeElement&&(b.type||b.href)}; $.editable.addInputType("datepicker",{element:function(b,c){var e=$(this),a=$("<input />");a.attr("autocomplete","off");e.append(a);return a},plugin:function(b,c){var e=this,a=e.find("input");b.onblur="nothing";datepicker={dateFormat:"yy-mm-dd",onSelect:function(){e.submit()},onClose:function(){setTimeout(function(){a.is(":focus")?e.submit():c.reset(e)},150)}};b.datepicker&&jQuery.extend(datepicker,b.datepicker);a.datepicker(datepicker)}});